<template name="home">
  <div class="page home">

    {{>nav title='Local Market' black=true}}

		{{> homeinside}}

	</div>
</template>

<template name="homeinside">
	<div class="content-scrollable">
		<div class="bg-image home">
			<h1 class="title-home">
				<img src="img/app/dolphin-kn42-1000x500.png" alt="Kn42 Personal Companion"/>
			</h1>
			<span class="hours"><span class="title-callout">Take me anywhere</span></span>
			<span class="arrow"></span>
		</div>

		<div class="callout-news">
			<span class="title-callout">News</span>
			{{latestNews.text}}
		</div>

		<h2 class="list-title">You are at:</h2>
		<div class="list-subtitle">See more</div>
		
		{{#if ifUser}}
			<div class="list-activities">
				{{> homelocation}}
			</div>		
		{{else}}
		
			<div style="width: 100%; height: auto; padding: 5px">
				We need to create profile for you before you can start using service			
			</div>
			<a href="{{pathFor 'about'}}" class="btn-primary" id="goprofile">Login</a>
			<br />
		{{/if}}
			
		<div >		
		</div>

		<div>
<!-- 		{{#if changeplace}}
			{{> selectPlace}}
		{{/if}} -->
		</div>
		<a href="{{pathFor 'geolog'}}" class="btn-primary">See what's cooking</a>
		
		<h2 class="list-title">What's Cooking</h2>
		<div class="list-subtitle">See what the community is cooking</div>
		<div class="list-activities">
		</div>
		<a href="{{pathFor 'geolog'}}" class="btn-primary">See what's cooking</a>

		<h2 class="list-title">Events and places around you</h2>
		<div class="list-subtitle">Hand-picked by the wisdom of automated processing</div>
		<div class="list-recipes">
			{{#if ifUser}}
				{{#if currentUser.profile.foursquare}}		
	<!-- 				{{> venues}} -->
				{{/if}}
			{{/if}}
<!-- 			{{#each featuredRecipes}}
				{{> recipeItem recipe=this size='small'}}
			{{/each}} -->
			
		</div>

		<a href="{{pathFor 'lifelog'}}" class="btn-primary">Explore your recent locations</a>

	</div>
</template>

<template name="homelocation">
	{{#with currentlocation}}
		<div style="width: 100%; height: auto; padding: 5px">
			<div class="selectplace" style="width: 100%; height: auto" id="
				{{#if status}}
					{{userPlace._id}}
				{{/if}}
			">
				<div style="display:inline-block; width: 85%; vertical-align: top;">
					{{#if userPlace.travel}}
						<div>
							Travelling<br />
							{{#if location.coords.speed}}speed {{location.coords.speed}} {{/if}}
							{{status}} since {{started}} {{#if timespent}}  for {{timespent}} {{/if}}
						</div>
					{{else}}
						<div>
							{{#if userPlace.name}} {{userPlace.name}} {{else}}
								{{#if geoPlace.name}} {{geoPlace.name}} {{else}} {{geoMerchant.name}} {{/if}}
							{{/if}}
						</div>
						<div style="font-size: smaller">
							{{#if geoPlace.name}}{{geoPlace.vicinity}} {{else}}{{geoMerchant.vicinity}} {{/if}}<br />
							{{status}} {{currentlocation.status}} {{#if currentlocation.status}} since {{started}} {{#if timespent}}  for {{timespent}} {{/if}} {{/if}}
<!-- 						<div>{{> venuesSelected}}</div> -->							
						</div>
					{{/if}}
					
				</div>
				<div style="display:inline-block; width: 10%; max-width: 40px; vertical-align: top;">
					<img style="width: auto; height: auto; max-width: 40px" src="
						{{#if geoPlace.name}}{{geoPlace.icon}} {{else}}{{geoMerchant.icon}} {{/if}}
					" />
				</div>
			</div>
			<div>
				{{#if status}}
					{{> buttons}}
				{{/if}}
			</div>
		</div>
	{{/with}}
</template>

<template name="locationmove">
		<div style="width: 100%; height: auto; padding: 5px">
			<div class="selectplace" style="width: 100%; height: auto" id="
				{{#if currentlocation.status}}
					{{userPlace._id}}
				{{/if}}
			">
				<div style="display:inline-block; width: 85%; vertical-align: top;">
					{{#if userPlace.travel}}
						<div>
							Travelling<br />
							{{#if location.coords.speed}}speed {{location.coords.speed}} {{/if}}
							{{status}} since {{started}} {{#if timespent}}  for {{timespent}} {{/if}}
						</div>
					{{else}}
						<div>
							{{#if userPlace.name}} {{userPlace.name}} {{else}}
								{{#if geoPlace.name}} {{geoPlace.name}} {{else}} {{geoMerchant.name}} {{/if}}
							{{/if}}
						</div>
						<div style="font-size: smaller">
							{{geoPlace.vicinity}} <br />
							{{status}} since {{started}} {{#if timespent}}  for {{timespent}} {{/if}}
<!-- 						<div>{{> venuesSelected}}</div> -->							
						</div>
					{{/if}}
					
				</div>
				<div style="display:inline-block; width: 10%; max-width: 40px; vertical-align: top;">
					<div>
						<img style="width: auto; height: auto; max-width: 40px" src="{{geoPlace.icon}}" />
					</div>
					{{#unless travel}}<div style="font-size: smaller">been: {{count}}</div>{{/unless}}
				</div>
			</div>
			<div>
				{{#if status}}
					{{> buttons}}
				{{/if}}
			</div>
		</div>
</template>

<template name="buttons">
	{{#with buttonsPlace}}
		<div>
			<div style="display: inline-block; width: auto; vertical-align: top; ">
				<form class="form-inline buttons" id="{{_id}}">
					<input type="button" class="button 
						{{#if confirmed}}undo{{else}}{{#if travel}}undo{{else}}confirm{{/if}}{{/if}}
						btn btn-small" id="{{_id}}" value="
						{{#if confirmed}}undo{{else}}{{#if travel}}undo{{else}}confirm{{/if}}{{/if}}
					" />

					{{#unless confirmed}}
						{{#unless travel}}
							<input type="button" class="button locations btn btn-small" data-toggle="modal" data-target="#myModal" id="{{_id}}" value="Change" />
							<input type="button" class="button travel btn btn-small" data-toggle="modal" data-target="#myModal" id="{{_id}}" value="Travel" />
						{{/unless}}
					{{/unless}}

					<input type="hidden" id="lat-{{userPlace._id}}" value="{{latitude}}">
					<input type="hidden" id="lng-{{userPlace._id}}" value="{{longitude}}">
				</form>
			</div>
			<div style="display: inline-block; width: 65%">
				{{#if confirmed}}
					{{> selectExperience}}
				{{/if}}
			</div>
			<br />
			<div>
				Claim your place:
				<input type="button" class="button claim btn btn-small" id="{{_id}}" value="Claim" />
			</div>
		</div>
	{{/with}}
</template>

<template name="claimPlace">
	<div style="padding :10px; padding-top: 50px">
<!--   {{> quickForm collection="ClaimedPlaces" id="claimPlace" type="insert" schema=schema}} -->
	{{> quickForm id="claimPlace" type="insert" collection="ClaimedPlaces" schema="Schemas.ClaimForm" fields="name, type, publ"}}
	
<!-- 	{{#autoForm collection="ClaimedPlaces" type="insert" id="claimPlace"}}
  {{> afQuickField name="a" options="allowed" noselect=true}}
  {{#if afFieldValueIs name="a" value="foo"}}
    {{> afQuickField name="b"}}
  {{/if}}
	{{/autoForm}} -->
	</div>
</template>

<template name="afInsertDemo">
{{#autoForm id="afInsertDemo" type="insert" collection="People"}}
  <div class="form-group {{#if afFieldIsInvalid name='firstName'}}has-error{{/if}}">
    <label class="control-label">{{afFieldLabelText name='firstName'}}</label>
    {{> afFieldInput name='firstName'}}
    {{#if afFieldIsInvalid name='firstName'}}
    <span class="help-block">{{{afFieldMessage name='firstName'}}}</span>
    {{/if}}
  </div>
  <div class="form-group {{#if afFieldIsInvalid name='lastName'}}has-error{{/if}}">
    <label class="control-label">{{afFieldLabelText name='lastName'}}</label>
    {{> afFieldInput name='lastName'}}
    {{#if afFieldIsInvalid name='lastName'}}
    <span class="help-block">{{{afFieldMessage name='lastName'}}}</span>
    {{/if}}
  </div>
  <div class="form-group {{#if afFieldIsInvalid name='age'}}has-error{{/if}}">
    <label class="control-label">{{afFieldLabelText name='age'}}</label>
    {{> afFieldInput name='age'}}
    {{#if afFieldIsInvalid name='age'}}
    <span class="help-block">{{{afFieldMessage name='age'}}}</span>
    {{/if}}
  </div>
  <div class="form-group">
    <button type="submit" class="btn btn-primary">Add Person</button>
    <button type="reset" class="btn btn-default">Reset Form</button>
  </div>
{{/autoForm}}
</template>

<template name="selectExperience">
	<div class="demo">
		<div class="control-group">
			<form class="form-inline" id="{{currentPlace}}">
<!-- 				<label for="select-{{currentPlace}}-empty">Add your experience:</label> -->
				<select id="select-{{currentPlace}}-empty" class="demo-default" data-placeholder="Select or create...">			
					{{#if experiences}}
						{{#each experiences}}
							<option value="{{experience}}">{{experience}}</option>
						{{/each}}
					{{else}}
						{{#each types}}
							<option value="{{this}}">{{this}}</option>
						{{/each}}
					{{/if}}			
					<option value="">None</option>
				</select>
				<input class="button btn inline-block" type="submit" value="Submit your experience">
			</form>
		</div>
		<script>
		$('#select-{{currentPlace}}-empty').selectize({
			allowEmptyOption: true,
			create: true
		});
		</script>
	</div>
</template>

<template name="venues">
	{{#if venuesNearby}}
		Foursquare venues <br />
		{{#each venuesNearby}}
			<div>
				{{#if url}}
					<a href="{{url}}" target=_blank>{{name}}</a>
				{{else}}
					{{name}}
				{{/if}}
				distance {{location.distance}}
			</div>
		{{/each}}
	{{else}}
		We cant find any foursquare venues around
	{{/if}}

<!-- 	<button class="button updatevenues btn btn-primary btn-xs btn-modal" style="bottom:0"> Update Venues</button> -->
</template>

<template name="venuesSelected">
	{{#if venuesSelected}}
		Foursquare venues <br />
		{{#each venuesSelected}}
			<div>
				{{#if url}}
					<a href="{{url}}" target=_blank>{{name}}</a>
				{{else}}
					{{name}}
				{{/if}}
				distance {{location.distance}}
			</div>
		{{/each}}
	{{else}}
		We can't find any foursquare venues around
	{{/if}}
<!-- 	<button class="button updatevenues btn btn-primary btn-xs btn-modal" style="bottom:0"> Update Venues</button> -->
</template>


<template name="_show_exp2">
	{{> buttons}}
	{{> venuesSelected}}
</template>

<template name="_no_exp2">
</template>

<template name="common_kn">

</template>
